openapi: 3.0.3
info:
  title: CloudAMQP API
  version: 1.0.0
  description: |
    Documentation for the CloudAMQP API.

    The API is used for creating instances and more and is available to customers that have signed up via [CloudAMQP](https://www.cloudamqp.com).

    **Note:** If you have signed up for CloudAMQP via Heroku you can not use this API. Please see the [add-on documentation](https://devcenter.heroku.com/articles/cloudamqp) instead.

    ## Authentication

    Authentication is done by sending your API key in the **password field** in Basic Auth. **The username should be kept empty.**

    **Example using curl:**
    ```bash
    curl -u :xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxx \
      https://customer.cloudamqp.com/api/instances
    ```

    You can find or create your API keys at [https://customer.cloudamqp.com/apikeys](https://customer.cloudamqp.com/apikeys)

    ## Additional Resources

    - [CloudAMQP technical changelog](changelog.html)
    - [Instance API documentation](instance-api.html) - Use after creating your instance to manage alarms, integrations, RabbitMQ, firewall, VPC peering and more
    - [CloudAMQP Terraform provider](terraform.html)

  contact:
    name: CloudAMQP
    url: https://www.cloudamqp.com

servers:
  - url: https://customer.cloudamqp.com/api
    description: CloudAMQP API Server

security:
  - basicAuth: []

tags:
  - name: Instances
    description: Operations for managing CloudAMQP instances
  - name: VPCs
    description: Virtual Private Cloud operations
  - name: Invoices
    description: Billing and invoice operations
  - name: Audit Log
    description: Audit log operations
  - name: Regions
    description: Available regions and datacenters
  - name: Team
    description: Team member management
  - name: API Keys
    description: API key management
  - name: Plans
    description: Available subscription plans

components:
  securitySchemes:
    basicAuth:
      type: http
      scheme: basic
      description: |
        Authentication is done by sending your API key in the password field in Basic Auth. The username should be kept empty.

        You can find or create your API keys at [https://customer.cloudamqp.com/apikeys](https://customer.cloudamqp.com/apikeys)

  schemas:
    Instance:
      type: object
      properties:
        id:
          type: integer
          description: Instance ID
          example: 1234
        plan:
          type: string
          description: Subscription plan name
          example: squirrel-1
        region:
          type: string
          description: Region identifier
          example: amazon-web-services::eu-west-1
        name:
          type: string
          description: Instance name
          example: My test
        tags:
          type: array
          items:
            type: string
          description: Instance tags
          example: [test-instance]
        providerid:
          type: string
          format: uuid
          description: Provider ID
          example: 12345678-1234-1234-1234-123456789abc
        vpc_id:
          type: integer
          description: VPC ID if instance is in a VPC
          example: 5678
        url:
          type: string
          description: AMQP connection URL
          example: amqp://user:password@fluffy-unicorn.rmq2.cloudamqp.com/vhost
        apikey:
          type: string
          format: uuid
          description: Instance API key for Instance API operations
          example: 87654321-4321-4321-4321-cba987654321
        ready:
          type: boolean
          description: Whether instance is ready
          example: true
        rmq_version:
          type: string
          description: RabbitMQ version
          example: 3.9.9
        urls:
          type: object
          properties:
            external:
              type: string
              description: External AMQPS connection URL
            internal:
              type: string
              description: Internal AMQP connection URL
        hostname_external:
          type: string
          description: External hostname
          example: fluffy-unicorn.rmq2.cloudamqp.com
        hostname_internal:
          type: string
          description: Internal hostname
          example: fluffy-unicorn.in.rmq2.cloudamqp.com

    InstanceCreate:
      type: object
      required:
        - name
        - plan
        - region
      properties:
        name:
          type: string
          description: The name of the instance
          example: test
        plan:
          type: string
          description: Which subscription plan and node combination to use
          example: lemming
        region:
          type: string
          description: Name of the region you want to create your instance in
          example: amazon-web-services::us-east-1
        tags:
          oneOf:
            - type: array
              items:
                type: string
            - type: string
          description: Tags for instance (array or comma separated list)
          example: [test-instance]
        vpc_subnet:
          type: string
          description: Dedicated VPC subnet, shouldn't overlap with your current VPC's subnet
          example: 10.56.72.0/24
        vpc_id:
          type: integer
          description: Id of an existing VPC to add the new instance to
          example: 5678
        nodes:
          type: integer
          description: Number of nodes in cluster (Deprecated)
          deprecated: true
        rmq_version:
          type: string
          description: RabbitMQ version
          example: 3.10.7
        copy_settings:
          type: object
          description: Copy settings from an existing subscription
          required:
            - subscription_id
            - settings
          properties:
            subscription_id:
              type: integer
              description: Instance ID to copy settings from
              example: 2234
            settings:
              type: array
              items:
                type: string
                enum: [alarms, definitions, metrics, logs, firewall, plugins, config]
              description: List of settings to copy
              example: [alarms, metrics, logs, firewall, config]
        preferred_az:
          oneOf:
            - type: array
              items:
                type: string
            - type: string
          description: Array or comma-separated string of availability zones for nodes

    InstanceUpdate:
      type: object
      properties:
        name:
          type: string
          description: The name of the instance
        plan:
          type: string
          description: Which subscription plan and node combination to use
        tags:
          oneOf:
            - type: array
              items:
                type: string
            - type: string
          description: Tags for instance (array or comma separated list)
        nodes:
          type: integer
          description: Number of nodes in cluster (Deprecated)
          deprecated: true

    DiskResize:
      type: object
      required:
        - extra_disk_size
      properties:
        extra_disk_size:
          type: integer
          description: Disk size to add, in gigabytes
          enum: [0, 25, 50, 100, 250, 500, 1000, 2000]
          example: 100
        allow_downtime:
          type: boolean
          description: Allow cluster downtime if needed when resizing disk
          example: true

    VPC:
      type: object
      properties:
        id:
          type: integer
          description: VPC ID
          example: 5678
        plan:
          type: string
          description: Plan type
          example: vpc
        region:
          type: string
          description: Region identifier
          example: amazon-web-services::eu-west-1
        name:
          type: string
          description: VPC name
          example: My test
        tags:
          type: array
          items:
            type: string
          description: VPC tags
          example: [test-vpc]
        providerid:
          type: string
          format: uuid
          description: Provider ID
        subnet:
          type: string
          description: VPC subnet
          example: 10.56.72.0/24
        instances:
          type: array
          items:
            type: integer
          description: Instance IDs in this VPC
          example: [1234]

    VPCCreate:
      type: object
      required:
        - name
        - region
        - subnet
      properties:
        name:
          type: string
          description: The name of the VPC
        region:
          type: string
          description: Name of the region you want to create your VPC in
        tags:
          oneOf:
            - type: array
              items:
                type: string
            - type: string
          description: Tags for VPC (array or comma separated list)
        subnet:
          type: string
          description: Dedicated VPC subnet, shouldn't overlap with your current VPC's subnet

    VPCUpdate:
      type: object
      properties:
        name:
          type: string
          description: The name of the VPC
        tags:
          oneOf:
            - type: array
              items:
                type: string
            - type: string
          description: Tags for VPC (array or comma separated list)

    Error:
      type: object
      properties:
        error:
          type: string
          description: Error message
        code:
          type: integer
          description: Error code

paths:
  /instances:
    get:
      summary: List instances
      description: Retrieves all instances
      operationId: listInstances
      tags:
        - Instances
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Instance'
              example:
                - id: 1234
                  plan: squirrel-1
                  region: amazon-web-services::eu-west-1
                  name: My test
                  tags: [test-instance]
                  providerid: 12345678-1234-1234-1234-123456789abc
                  vpc_id: 5678

    post:
      summary: Create an instance
      description: Creates a new CloudAMQP instance. Name, plan and region are required.
      operationId: createInstance
      tags:
        - Instances
      requestBody:
        required: true
        content:
          application/x-www-form-urlencoded:
            schema:
              $ref: '#/components/schemas/InstanceCreate'
          application/json:
            schema:
              $ref: '#/components/schemas/InstanceCreate'
            example:
              name: My new instance
              plan: bunny-1
              region: amazon-web-services::us-east-1
              copy_settings:
                subscription_id: 2234
                settings: [alarms, metrics, logs, firewall, config]
      responses:
        '200':
          description: Instance created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: integer
                  url:
                    type: string
                  apikey:
                    type: string
              example:
                id: 2234
                url: amqp://user:password@lemur.cloudamqp.com/vhost
                apikey: 87654321-4321-4321-4321-cba987654321

  /instances/{id}:
    parameters:
      - name: id
        in: path
        required: true
        description: The ID of the instance
        schema:
          type: integer

    get:
      summary: Get instance info
      description: Retrieves a specific instance. The API key returned is used for Instance API operations.
      operationId: getInstance
      tags:
        - Instances
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Instance'
              example:
                id: 1234
                plan: squirrel-1
                region: amazon-web-services::eu-west-1
                providerid: 12345678-1234-1234-1234-123456789abc
                name: My test
                tags: [test-instance]
                url: amqp://user:password@fluffy-unicorn.rmq2.cloudamqp.com/vhost
                apikey: 87654321-4321-4321-4321-cba987654321
                ready: true
                rmq_version: 3.9.9
        '404':
          description: Instance not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

    put:
      summary: Update an instance
      description: Updates an instance
      operationId: updateInstance
      tags:
        - Instances
      requestBody:
        required: true
        content:
          application/x-www-form-urlencoded:
            schema:
              $ref: '#/components/schemas/InstanceUpdate'
      responses:
        '200':
          description: Instance updated successfully
        '404':
          description: Instance not found

    delete:
      summary: Delete an instance
      description: Deletes an instance
      operationId: deleteInstance
      tags:
        - Instances
      responses:
        '200':
          description: Instance deleted successfully
        '404':
          description: Instance not found

  /instances/{id}/disk:
    parameters:
      - name: id
        in: path
        required: true
        description: The ID of the instance
        schema:
          type: integer

    put:
      summary: Edit instance disk size
      description: |
        Resizes the disk size of an instance. Default behavior is to expand the disk without any downtime.
        Currently limited to instances in Amazon Web Services (AWS) and Google Compute Engine (GCE).

        **Note:** This action is asynchronous. The request will return almost immediately. The disk resize runs in the background.

        **Note:** Due to restrictions from cloud providers, it's only possible to resize the disk every 8 hours unless `allow_downtime=true` is set.
      operationId: resizeInstanceDisk
      tags:
        - Instances
      requestBody:
        required: true
        content:
          application/x-www-form-urlencoded:
            schema:
              $ref: '#/components/schemas/DiskResize'
      responses:
        '200':
          description: Disk resize initiated successfully
        '400':
          description: Bad request (e.g., time rate limit)
        '404':
          description: Instance not found

  /vpcs:
    get:
      summary: List VPCs
      description: Retrieves all VPCs
      operationId: listVPCs
      tags:
        - VPCs
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/VPC'
              example:
                - id: 5678
                  plan: vpc
                  region: amazon-web-services::eu-west-1
                  name: My test
                  tags: [test-vpc]
                  providerid: 12345678-1234-1234-1234-123456789abc
                  subnet: 10.56.72.0/24
                  instances: [1234]

    post:
      summary: Create a VPC
      description: Creates a new VPC. Name, subnet and region are required.
      operationId: createVPC
      tags:
        - VPCs
      requestBody:
        required: true
        content:
          application/x-www-form-urlencoded:
            schema:
              $ref: '#/components/schemas/VPCCreate'
      responses:
        '200':
          description: VPC created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: integer
                  apikey:
                    type: string
              example:
                id: 2234
                apikey: 87654321-4321-4321-4321-cba987654321

  /vpcs/{id}:
    parameters:
      - name: id
        in: path
        required: true
        description: The ID of the VPC
        schema:
          type: integer

    get:
      summary: Get VPC info
      description: Retrieves a specific VPC
      operationId: getVPC
      tags:
        - VPCs
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/VPC'
              example:
                id: 5678
                plan: vpc
                region: amazon-web-services::eu-west-1
                name: My test
                tags: [test-vpc]
                providerid: 12345678-1234-1234-1234-123456789abc
                subnet: 10.56.72.0/24
                instances: [1234]
        '404':
          description: VPC not found

    put:
      summary: Update a VPC
      description: Updates a VPC
      operationId: updateVPC
      tags:
        - VPCs
      requestBody:
        required: true
        content:
          application/x-www-form-urlencoded:
            schema:
              $ref: '#/components/schemas/VPCUpdate'
      responses:
        '200':
          description: VPC updated successfully
        '404':
          description: VPC not found

    delete:
      summary: Delete a VPC
      description: Deletes a VPC
      operationId: deleteVPC
      tags:
        - VPCs
      responses:
        '200':
          description: VPC deleted successfully
        '404':
          description: VPC not found

  /invoices:
    get:
      summary: List invoices
      description: Retrieves all invoices, optionally filtered by date range
      operationId: listInvoices
      tags:
        - Invoices
      parameters:
        - name: from
          in: query
          description: Year-month start (e.g., 2022-05)
          schema:
            type: string
            pattern: '^\d{4}-\d{2}$'
        - name: to
          in: query
          description: Year-month end (e.g., 2022-06)
          schema:
            type: string
            pattern: '^\d{4}-\d{2}$'
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    id:
                      type: integer
                    period:
                      type: string
                    number:
                      type: integer
                    paid:
                      type: boolean
                    total:
                      type: number
                    currency:
                      type: string
                    account_name:
                      type: string

  /invoices/period:
    get:
      summary: Get invoice for a specific period
      description: Retrieves invoice details for a specific period
      operationId: getInvoiceForPeriod
      tags:
        - Invoices
      parameters:
        - name: year
          in: query
          description: Year to calculate for
          required: true
          schema:
            type: integer
        - name: month
          in: query
          description: Month (1-12)
          required: true
          schema:
            type: integer
            minimum: 1
            maximum: 12
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
                properties:
                  period:
                    type: string
                  total:
                    type: number
                  currency:
                    type: string
                  lines:
                    type: array
                    items:
                      type: object
                  customer:
                    type: object
                  seller:
                    type: object

  /invoices/{id}:
    parameters:
      - name: id
        in: path
        required: true
        description: The invoice ID
        schema:
          type: integer
    get:
      summary: Get invoice by ID
      description: Retrieves a specific invoice by ID
      operationId: getInvoice
      tags:
        - Invoices
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
                properties:
                  period:
                    type: string
                  total:
                    type: number
                  currency:
                    type: string
                  lines:
                    type: array
                    items:
                      type: object
                  customer:
                    type: object
                  seller:
                    type: object

  /auditlog/csv:
    get:
      summary: Get audit log in CSV format
      description: Returns audit log in CSV format for latest month or for month specified in params
      operationId: getAuditLogCSV
      tags:
        - Audit Log
      parameters:
        - name: timestamp
          in: query
          description: YYYY-MM format (e.g., 2022-12)
          schema:
            type: string
            pattern: '^\d{4}-\d{2}$'
      responses:
        '200':
          description: Successful response
          content:
            text/csv:
              schema:
                type: string

  /regions:
    get:
      summary: List available regions
      description: Retrieves all available regions, optionally filtered by provider
      operationId: listRegions
      tags:
        - Regions
      parameters:
        - name: provider
          in: query
          description: Filter by specific provider (e.g., amazon-web-services)
          schema:
            type: string
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    provider:
                      type: string
                    region:
                      type: string
                    name:
                      type: string
                    has_shared_plans:
                      type: boolean

  /team:
    get:
      summary: List team members
      description: Retrieves all team members
      operationId: listTeamMembers
      tags:
        - Team
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    id:
                      type: string
                      format: uuid
                    email:
                      type: string
                    tfa_auth_enabled:
                      type: boolean
                    roles:
                      type: array
                      items:
                        type: string

  /team/invite:
    post:
      summary: Invite a new user to the team
      description: Invites a user to join the team with specified role
      operationId: inviteTeamMember
      tags:
        - Team
      requestBody:
        required: true
        content:
          application/x-www-form-urlencoded:
            schema:
              type: object
              required:
                - email
              properties:
                email:
                  type: string
                  format: email
                role:
                  type: string
                  enum: [admin, devops, member, monitor, billing manager]
                  default: member
                tags:
                  oneOf:
                    - type: array
                      items:
                        type: string
                    - type: string
      responses:
        '200':
          description: Invitation sent
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string

  /team/remove:
    post:
      summary: Remove a user from the team
      description: Removes a user from the team
      operationId: removeTeamMember
      tags:
        - Team
      requestBody:
        required: true
        content:
          application/x-www-form-urlencoded:
            schema:
              type: object
              required:
                - email
              properties:
                email:
                  type: string
                  format: email
      responses:
        '200':
          description: User removed
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string

  /team/{userId}:
    parameters:
      - name: userId
        in: path
        required: true
        description: The user ID
        schema:
          type: string
          format: uuid
    put:
      summary: Update user role and tags
      description: Updates role and tags for a user in the team
      operationId: updateTeamMember
      tags:
        - Team
      requestBody:
        required: true
        content:
          application/x-www-form-urlencoded:
            schema:
              type: object
              properties:
                role:
                  type: string
                  enum: [admin, devops, member, monitor, billing manager]
                tags:
                  oneOf:
                    - type: array
                      items:
                        type: string
                    - type: string
      responses:
        '200':
          description: User updated
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string

  /apikeys/rotate-apikey:
    post:
      summary: Rotate API key
      description: Removes the current API key and creates a new one with matching permissions
      operationId: rotateApiKey
      tags:
        - API Keys
      responses:
        '200':
          description: API key rotated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  apikey:
                    type: string

  /plans:
    get:
      summary: List available plans
      description: Retrieves all available subscription plans, optionally filtered by backend
      operationId: listPlans
      tags:
        - Plans
      parameters:
        - name: backend
          in: query
          description: Filter by specific backend software
          schema:
            type: string
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    name:
                      type: string
                    price:
                      type: number
                    backend:
                      type: string
                    shared:
                      type: boolean
